# Voice Agent Test Scenarios Library
# Used by: Voice Agent Tester - Automated Simulation (IZIj5oh3VwCVJb34)
# API: ElevenLabs simulate_conversation

version: "1.0"
last_updated: "2025-12-27"

# Default agent for all tests (can be overridden per scenario)
default_agent_id: "agent_8001kdgp7qbyf4wvhs540be78vew"

scenarios:
  # ============================================
  # HAPPY PATH SCENARIOS
  # ============================================
  
  - id: happy-path-booking
    name: "Happy Path - User Books Demo"
    category: happy_path
    priority: critical
    description: "Ideal caller who wants to learn about AI voice agents and agrees to SMS booking"
    simulated_user_prompt: |
      You are calling to learn about AI voice agents for your dental practice. 
      You are interested and when offered, you agree to receive an SMS with the booking link. 
      Your name is Dr. Smith.
    expected_tool_calls:
      - send_sms
    evaluation_criteria:
      - id: collected_name
        name: "Collected caller name"
        prompt: "The agent asked for and collected the caller's name before sending SMS."
      - id: got_permission
        name: "Got SMS permission"
        prompt: "The agent explicitly asked for and received permission to send a text message."
      - id: sent_sms
        name: "SMS tool called"
        prompt: "The agent successfully called the send_sms tool."

  - id: quick-sale
    name: "Quick Sale - Ready to Buy"
    category: happy_path
    priority: high
    description: "Caller who already knows what they want and is ready to proceed"
    simulated_user_prompt: |
      You already know about AI voice agents. You want to book a demo right away.
      Say yes to everything and give your name as Jennifer when asked.
    expected_tool_calls:
      - send_sms
    evaluation_criteria:
      - id: efficient_handling
        name: "Efficient handling"
        prompt: "The agent moved quickly to book without unnecessary questions."
      - id: sent_sms
        name: "SMS sent"
        prompt: "The agent sent the SMS booking link."

  # ============================================
  # EDGE CASE SCENARIOS
  # ============================================

  - id: difficult-user
    name: "Difficult User - Skeptical and Interruptive"
    category: edge_case
    priority: high
    description: "Very skeptical caller who interrupts and asks tough questions"
    simulated_user_prompt: |
      You are very skeptical about AI. You interrupt frequently. 
      You ask tough questions about pricing and want to know if this is a scam. 
      Eventually warm up if the agent handles objections well.
    expected_tool_calls: []
    evaluation_criteria:
      - id: stayed_polite
        name: "Maintained professionalism"
        prompt: "The agent remained polite and professional despite the difficult caller."
      - id: answered_pricing
        name: "Answered pricing question"
        prompt: "The agent provided accurate pricing information when asked."

  - id: quick-decline
    name: "Quick Decline - Not Interested"
    category: edge_case
    priority: medium
    description: "Caller who dialed wrong number or isn't interested"
    simulated_user_prompt: |
      You called by accident. Say you're not interested and want to hang up quickly.
    expected_tool_calls: []
    evaluation_criteria:
      - id: graceful_exit
        name: "Graceful exit"
        prompt: "The agent ended the call politely and professionally when the caller wasn't interested."
      - id: no_pushy_sales
        name: "Not pushy"
        prompt: "The agent did not aggressively push for a sale when the caller clearly wasn't interested."

  - id: sms-decline
    name: "SMS Decline - Interested but No Text"
    category: edge_case
    priority: high
    description: "Interested caller who refuses SMS"
    simulated_user_prompt: |
      You are interested in AI voice agents but you don't want to receive text messages. 
      Ask for the booking URL verbally instead.
    expected_tool_calls: []
    evaluation_criteria:
      - id: respected_preference
        name: "Respected no-SMS preference"
        prompt: "The agent respected the caller's preference not to receive SMS."
      - id: offered_alternative
        name: "Offered alternative"
        prompt: "The agent offered an alternative way to get the booking information."

  # ============================================
  # STRESS TEST SCENARIOS
  # ============================================

  - id: confused-caller
    name: "Confused Caller - Unclear About Needs"
    category: stress_test
    priority: medium
    description: "Caller who doesn't know what they want"
    simulated_user_prompt: |
      You're not sure what AI voice agents are. You're confused about whether this is 
      telemarketing or a real service. Ask basic questions and need hand-holding.
    expected_tool_calls: []
    evaluation_criteria:
      - id: patient_explanation
        name: "Patient explanation"
        prompt: "The agent patiently explained the service without condescension."
      - id: clarified_service
        name: "Clarified service"
        prompt: "The agent successfully clarified what Wranngle Systems offers."

  - id: price-haggler
    name: "Price Haggler - Wants Discount"
    category: stress_test
    priority: medium
    description: "Caller who likes the product but wants a lower price"
    simulated_user_prompt: |
      You love the idea of AI voice agents but think $3500 setup is too expensive.
      Ask for a discount repeatedly. Push back on the pricing.
    expected_tool_calls: []
    evaluation_criteria:
      - id: maintained_pricing
        name: "Maintained pricing"
        prompt: "The agent did not offer unauthorized discounts."
      - id: handled_objection
        name: "Handled price objection"
        prompt: "The agent handled the price objection professionally."

  - id: technical-questions
    name: "Technical Deep Dive - Developer Caller"
    category: stress_test
    priority: low
    description: "Technical caller asking about implementation details"
    simulated_user_prompt: |
      You are a software developer. Ask technical questions about the API,
      integration options, and how the AI handles edge cases.
    expected_tool_calls: []
    evaluation_criteria:
      - id: redirected_technical
        name: "Redirected technical questions"
        prompt: "The agent appropriately redirected deep technical questions to a demo or specialist."
      - id: admitted_limits
        name: "Admitted knowledge limits"
        prompt: "The agent honestly admitted when questions were beyond their knowledge base."

  # ============================================
  # TOOL VALIDATION SCENARIOS
  # ============================================

  - id: tool-retry
    name: "Tool Retry - First Attempt Fails"
    category: tool_validation
    priority: critical
    description: "Tests agent behavior when tool fails on first attempt"
    simulated_user_prompt: |
      You want to book a demo. Your name is Alex. When the agent tries to send SMS,
      pretend there was a problem and ask them to try again.
    expected_tool_calls:
      - send_sms
    evaluation_criteria:
      - id: attempted_retry
        name: "Attempted retry"
        prompt: "The agent attempted to retry the SMS when the first attempt appeared to fail."
      - id: graceful_fallback
        name: "Graceful fallback"
        prompt: "If retry failed, the agent offered an alternative like spelling the URL."

  - id: premature-confirm
    name: "Premature Confirmation Check"
    category: tool_validation
    priority: critical
    description: "Tests that agent doesn't claim SMS sent before tool executes"
    simulated_user_prompt: |
      You want the booking link texted to you. Your name is Sam.
      Pay close attention to whether the agent says they sent the text BEFORE
      you hear the tool being called.
    expected_tool_calls:
      - send_sms
    evaluation_criteria:
      - id: no_premature_confirm
        name: "No premature confirmation"
        prompt: "The agent did NOT claim the SMS was sent before the tool actually executed."
      - id: proper_sequence
        name: "Proper tool sequence"
        prompt: "The agent asked for name, asked permission, called tool, then confirmed delivery - in that order."

# ============================================
# CONFIGURATION
# ============================================

simulation_settings:
  llm: "gpt-4o"
  temperature: 0.7
  max_turns: 20
  timeout_ms: 120000

alerting:
  webhook_url: "https://n8n.wranngle.com/webhook/voice-agent-test-alert"
  notify_on:
    - critical_failure
    - tool_validation_failure
    - success_rate_below: 80
